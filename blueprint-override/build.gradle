subprojects {

    configurations {
        extender
        patch
    }

    dependencies {
        compile ("org.osgi:org.osgi.core:${project.ext.osgiVersion}")
    }

    if(new File("${project.projectDir}/dependencies.gradle").exists()) {
        // Don't use default dependencies but the ones that work with that Alfresco version
        apply from: "${project.projectDir}/dependencies.gradle"
    } else {
        apply from: "${project.parent.projectDir}/default-dependencies.gradle"
    }

    project.tasks.remove(jar)

    task patch(type: Zip) {
        from(zipTree(configurations.extender.first())) {
            exclude("**/DefaultApplicationContextConfigurationFactory.class")
        }
        from(sourceSets.main.output)

        destinationDir = libsDir
        extension = 'jar'
        baseName = 'blueprint-synchronous'
    }

    artifacts {
        patch file: patch.archivePath, name: 'blueprint-synchronous', type: 'jar', builtBy: patch
    }

    defaultTasks 'patch'

}
